# Filename: DetectAndRespondToPloutus.ps1

# Define known IoCs for Ploutus ATM Malware
$maliciousProcesses = @("Ploutus.exe", "MaliciousProcessName.exe")
$maliciousFiles = @("C:\Windows\System32\ploutus.dll", "C:\ProgramData\malware.exe")
$maliciousRegistryKeys = @("HKLM:\SOFTWARE\MaliciousKey", "HKCU:\Software\MaliciousKey")

# Function to stop malicious processes
function Stop-MaliciousProcesses {
    foreach ($processName in $maliciousProcesses) {
        $process = Get-Process -Name $processName -ErrorAction SilentlyContinue
        if ($process) {
            Write-Output "Stopping malicious process: $processName"
            Stop-Process -Name $processName -Force
        }
    }
}

# Function to remove malicious files
function Remove-MaliciousFiles {
    foreach ($filePath in $maliciousFiles) {
        if (Test-Path $filePath) {
            Write-Output "Removing malicious file: $filePath"
            Remove-Item $filePath -Force
        }
    }
}

# Function to remove malicious registry keys
function Remove-MaliciousRegistryKeys {
    foreach ($regKey in $maliciousRegistryKeys) {
        if (Test-Path $regKey) {
            Write-Output "Removing malicious registry key: $regKey"
            Remove-Item $regKey -Recurse -Force
        }
    }
}

# Function to log the detection and response actions
function Log-DetectionResponse {
    $logFilePath = "C:\ATM_Security\PloutusDetectionLog.txt"
    $timeStamp = Get-Date -Format "yyyy-MM-dd HH:mm:ss"
    $message = $timeStamp + " - " + $args[0]
    Add-Content -Path $logFilePath -Value $message
}

# Main function to detect and respond to Ploutus malware
function Detect-And-Respond {
    Write-Output "Starting detection and response for Ploutus ATM Malware"

    # Check for malicious processes
    foreach ($processName in $maliciousProcesses) {
        $process = Get-Process -Name $processName -ErrorAction SilentlyContinue
        if ($process) {
            Log-DetectionResponse "Malicious process detected: $processName"
            Stop-MaliciousProcesses
        }
    }

    # Check for malicious files
    foreach ($filePath in $maliciousFiles) {
        if (Test-Path $filePath) {
            Log-DetectionResponse "Malicious file detected: $filePath"
            Remove-MaliciousFiles
        }
    }

    # Check for malicious registry keys
    foreach ($regKey in $maliciousRegistryKeys) {
        if (Test-Path $regKey) {
            Log-DetectionResponse "Malicious registry key detected: $regKey"
            Remove-MaliciousRegistryKeys
        }
    }

    Write-Output "Detection and response process completed"
    Log-DetectionResponse "Detection and response process completed"
}

# Execute the detection and response function
Detect-And-Respond
